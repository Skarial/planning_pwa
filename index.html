<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Planning chauffeur</title>
    <meta
      name="description"
      content="Gestion du planning de service pour chauffeurs"
    />

    <!-- PWA -->
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />

    <link rel="manifest" href="./manifest.webmanifest" />

    <!-- iOS icon -->
    <link rel="apple-touch-icon" href="./assets/icons/icon-192.png" />

    <!-- Favicon -->
    <link rel="icon" href="./assets/icons/icon-192.png" />
    <style>
      html,
      body {
        background: #ffffff !important;
      }
    </style>

    <!-- Styles -->
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/tetribus.css" />
  </head>

  <body>
    <div id="app-boot-screen"></div>

    <!-- MENU -->
    <button id="menu-toggle" aria-label="Menu">☰</button>
    <div id="menu-overlay"></div>

    <nav id="side-menu" aria-hidden="true">
      <div id="side-menu-scroll">
        <div class="menu-section">
          <h3>Navigation</h3>

          <button data-action="day">
            <span class="menu-icon icon-day"></span>
            Vue jour
          </button>

          <button data-action="month">
            <span class="menu-icon icon-month"></span>
            Planning mensuel
          </button>

          <button data-action="guided-month">
            <span class="menu-icon icon-guided"></span>
            Préparer mois suivant
          </button>

          <button data-action="tetribus">
            <span class="menu-icon icon-game"></span>
            Tetribus
          </button>
        </div>

        <div class="menu-section">
          <h3>Outils</h3>

          <button id="menu-consult-date">
            <span class="menu-icon icon-consult"></span>
            Consulter une date
          </button>

          <div id="consult-date-form" class="menu-form hidden">
            <label for="consult-date-input">Date</label>
            <input type="date" id="consult-date-input" />
            <button id="consult-date-submit">Valider</button>
          </div>

          <button id="menu-season">
            <span class="menu-icon icon-season"></span>
            Période saisonnière
          </button>

          <div id="season-form" class="menu-form hidden">
            <label for="season-start">Début</label>
            <input type="date" id="season-start" />
            <label for="season-end">Fin</label>
            <input type="date" id="season-end" />
            <button id="season-submit">Valider</button>
            <button id="season-reset" type="button">
              Réinitialiser la saison
            </button>
          </div>

          <button disabled>Import CSV</button>
        </div>

        <div class="menu-section">
          <h3>Paramètres</h3>

          <button id="toggle-dark">
            <span class="menu-icon icon-dark"></span>
            Mode sombre
          </button>

          <button id="menu-reset" class="danger">
            <span class="menu-icon icon-reset"></span>
            Réinitialisation
          </button>

          <div id="reset-panel" class="menu-form hidden">
            <p class="reset-title">Réinitialisation du planning</p>

            <button id="reset-all" class="danger menu-long-press" type="button">
              Maintenir pour tout réinitialiser
            </button>

            <button id="reset-month">Réinitialiser un mois</button>

            <div id="reset-month-picker" class="hidden">
              <div class="reset-month-nav">
                <button
                  id="reset-prev-month"
                  class="today-arrow arrow-left"
                ></button>
                <span id="reset-month-label"></span>
                <button
                  id="reset-next-month"
                  class="today-arrow arrow-right"
                ></button>
              </div>

              <button id="reset-confirm-month" class="danger menu-long-press">
                Maintenir pour réinitialiser le mois
              </button>
            </div>
          </div>
        </div>

        <div id="menu-footer">
          <span id="app-version"></span>
        </div>
      </div>
    </nav>

    <!-- VUES -->
    <section id="view-home"></section>
    <section id="view-day" style="display: none"></section>
    <section id="view-month" style="display: none"></section>
    <section id="view-guided-month" style="display: none"></section>
    <section id="view-tetribus" style="display: none">
      <div id="tetribus">
        <div id="game-container">
          <div id="header">
            <h1>Tetribus</h1>
            <div>
              <span id="score">Score : <span id="score-value">0</span></span>
              |
              <span id="level">Niveau : <span id="level-value">1</span></span>
            </div>
          </div>

          <div id="game-area">
            <div id="canvas-wrapper">
              <canvas id="game-canvas"></canvas>
            </div>

            <div id="game-over" class="hidden">
              <h2>Partie terminée</h2>
              <p>Score final : <span id="final-score">0</span></p>
              <button id="restart-btn">Recommencer</button>
            </div>
          </div>

          <div id="controls-area">
            <button id="btn-left" class="control-btn btn-left"></button>
            <button id="btn-rotate" class="control-btn btn-rotate"></button>
            <button id="btn-right" class="control-btn btn-right"></button>
          </div>
        </div>
      </div>
    </section>

    <!-- APP -->
    <script type="module" src="./js/app.js"></script>
    <!-- NOTIFICATION MISE À JOUR -->
    <div id="update-banner" class="update-banner hidden">
      <div class="update-content">
        <div class="update-text">
          <strong>Mise à jour disponible</strong>
          <span>Une nouvelle version de l’application est prête.</span>
        </div>

        <div class="update-actions">
          <button id="update-reload" class="btn-primary">Mettre à jour</button>
          <button id="update-later" class="btn-secondary">Plus tard</button>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("contextmenu", function (e) {
        if (
          e.target.closest(".menu-long-press") ||
          e.target.closest("#view-tetribus")
        ) {
          e.preventDefault();
        }
      });
    </script>
  </body>
</html>
